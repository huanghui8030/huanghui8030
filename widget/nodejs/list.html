<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>全部列表页面（文件中读取）</title>
    <link rel="stylesheet" href="https://t1.chei.com.cn/common/plugins/jquery-datatables/css/jquery.datatables.min.css">
    <link rel="stylesheet" href="http://t2.chei.com.cn/common/bootstrap3.3.5/css/bootstrap.min.css">
    <style>
    h1 {
        text-align: center;
        font-size: 30px;
    }
    ul, ol, li {
        list-style: normal;
    }
    a, a:link, a:visited {
        color: #2484c3;
        text-decoration: none;
    }
    a:visited {
        color: #143bb9
    }
    a:hover {
        text-decoration: underline;
        color: #63B7EF;
    }
    .content-bolck {
        margin: 20px 50px;
    }
    .other-link {
        margin-bottom: 20px
    }
    .other-link a {
        margin-right: 20px
    }
    .table {
        width: 100%;
        margin: 20px 0;
        border-right: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        border-spacing: 0;
    }
    h3 {
        text-align: center;
        font-size: 20px;
        border-top: 1px solid #333;
        margin-top: 20px;
        padding-top: 20px;
    }
    .table td, .table th {
        border-top: 1px solid #ccc;
        border-left: 1px solid #ccc;
    }
    .table th {
        font-size: 16px;
    }
    .table tr:hover {
        background: #fcfcf3;
    }
    /** datatables */

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        height: 32px;
        line-height: 30px;
        text-align: center;
        padding: 0 10px;
        font-size: 14px;
        color: #fff;
        border-radius: 5px;
    }
    .dataTables_wrapper .dataTables_filter input {
        height: 32px;
        line-height: 32px;
        padding: 2px 10px;
    }
    </style>
</head>

<body>
    <h1>大屏展示全部列表页面</h1>
    <div class='content-bolck'>
        <div class="other-link">
            <a href="/add.html">添加页面</a>
        </div>
        <table id='table-list' class="table">
            <thead>
                <th width="38">序号</th>
                <th width="38">页面ID</th>
                <th>页面名称</th>
                <th width="70">页面链接</th>
                <th width="70">业务类型</th>
                <th width="70">语种</th>
                <th width="70">数据类型</th>
                <th width="70">运行状态</th>
                <th width="70">对外展示许可</th>
                <th width="70">页面更新时间</th>
                <th width="70">页面更新人</th>
                <th width="70">页面更新记录</th>
                <th width="70">数据更新时间</th>
                <th width="70">操作</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="modal-update" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">修改页面属性设置</h4>
                </div>
                <form id="form-add" method="post" action="updatepage">
                    <div class="modal-body">
                        <table>
                            <tr>
                                <th>页面名称：</th>
                                <td>
                                    <input type="text" id="name" name="name" placeholder="页面名称" />
                                </td>
                            </tr>
                            <tr>
                                <th>页面链接：</th>
                                <td>
                                    <input type="text" id="url" name="url" placeholder="页面链接 " />
                                </td>
                            </tr>
                            <tr>
                                <th>业务类型：</th>
                                <td>
                                    <select name="businesstype" id='businesstype'>
                                        <option value="对外服务">对外服务</option>
                                        <option value="高考">高考</option>
                                        <option value="研招">研招</option>
                                        <option value="学籍学历">学籍学历</option>
                                        <option value="征兵">征兵</option>
                                        <option value="宣传推广">宣传推广</option>
                                        <option value="满意度">满意度</option>
                                        <option value="就业">就业</option>
                                        <option value="其他承接的服务">其他承接的服务</option>
                                        <option value="基础设置">基础设置</option>
                                        <option value="硬件设备">硬件设备</option>
                                        <option value="系统运维">系统运维</option>
                                        <option value="数据统计">数据统计</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>语种：</th>
                                <td>
                                    <select name="language" id="language">
                                        <option value="中文">中文</option>
                                        <option value="英文">英文</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>数据类型：</th>
                                <td>
                                    <select name="datatype" id="datatype">
                                        <option value='静态'>静态</option>
                                        <option value='动态'>动态</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>运行状态：</th>
                                <td>
                                    <select name="runtype" id="runtype">
                                        <option value="正常">正常</option>
                                        <option value="故障">故障</option>
                                        <option value="开发中">开发中</option>
                                    </select>
                                    <input type="text" name="reason" id="reason" value="" placeholder="故障原因" style="display: none">
                                </td>
                            </tr>
                            <tr>
                                <th>对外展示许可：</th>
                                <td>
                                    <select name="opentype" id="opentype">
                                        <option value="全公开">全公开</option>
                                        <option value="禁止对国外来宾公开">禁止对国外来宾公开</option>
                                        <option value="仅对国外来宾公开">仅对国外来宾公开</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>页面更新人：</th>
                                <td>
                                    <input type="text" name="author" id="author" value="" placeholder="页面更新人">
                                </td>
                            </tr>
                            <tr>
                                <th>页面更新记录：</th>
                                <td>
                                    <input type="text" name="record" id="record" value="" placeholder="页面更新记录">
                                </td>
                            </tr>
                            <tr>
                                <th>数据更新日期：</th>
                                <td>
                                    <input type="text" name="datatime" id="datatime" value="" placeholder="数据更新日期">
                                </td>
                            </tr>
                            <!-- <tr>
                        <th>
                        <td><input type="submit" value="保存" /></td>
                    </tr> -->
                        </table>
                        <input type="hidden" name='id' id='id'>
                        </th>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="http://t1.chei.com.cn/common/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://t1.chei.com.cn/common/plugins/jquery-datatables/js/jquery.datatables.min.js"></script>
    <script src="http://t1.chei.com.cn/common/bootstrap3.3.5/js/bootstrap.min.js"></script>
    <script>
    $(function() {
        showTableList();
        deleteOnly();
        updateOnly();
        $("#modal-update").on("hidden", function() {
            window.location.reload();
        });
    })
    /**显示table格式的列表
     * @return {null} 返回null
     * @author huangh@chsi.com.cn 20170525
     */
    function showTableList() {
        var data = getTableData('file/file.json'); //需要先获取data
        console.log(data);
        if (!!Function.prototype.bind) {
            $('#table-list').DataTable({
                data: data
            });
        } else {
            alert('浏览器版本太低，更更换浏览器！');
        }
    }
    /**获取表格数据   
     * @param  {String} path json文件 
     * @return {Array}  返回数组格式的数据
     * @author huangh@chsi.com.cn 20170525
     */
    function getTableData(path) {
        var newData = [];
        $.ajaxSettings.async = false; //异步请求数据改成同步请求，很重要！
        $.getJSON(path, function(data) {
            $.each(data, function(index, content) {
                var operateHtml = '<a href="#" data-toggle="modal" data-target="#modal-update" class="update" id="update-' + content.id + '">修改</a>&ensp;&ensp;<a  class="delete" id="delete-' + content.id + '">删除</a>';

                newData.push([index + 1, content.id, content.name, content.url, content.businesstype, content.language, content.datatype, content.runtype, content.opentype, content.updatetime, content.author, content.record, content.datatime, operateHtml]);
            });
        });
        return newData;
    }

    function updateOnly() {
        $('.update').click(function() {
            var id = $(this).attr('id').substring(7);
            $.ajax({
                type: 'POST',
                url: '/update',
                cache: false,
                data: {
                    id: id
                },
                error: function() {
                    alert('加载页面时出错！')
                },
                success: function(data, textStatus, request) {
                    var dataJson = eval('(' + data + ')');
                    if (id == dataJson.id) {
                        var $modal = $("#modal-update");
                        $modal.find('#id').val(dataJson.id)
                            .end().find('#name').val(dataJson.name)
                            .end().find('#url').val(dataJson.url)
                            .end().find('#businesstype').val(dataJson.businesstype)
                            .end().find('#language').val(dataJson.language)
                            .end().find('#datatype').val(dataJson.datatype)
                            .end().find('#runtype').val(dataJson.runtype)
                            .end().find('#opentype').val(dataJson.opentype)
                            .end().find('#author').val(dataJson.author)
                            .end().find('#record').val(dataJson.record)
                            .end().find('#datatime').val(dataJson.datatime);
                    }

                }
            });
        })
    }

    function deleteOnly() {
        $('.delete').click(function() {
            var $this = $(this);
            var id = $this.attr('id').substring(7);
            $.ajax({
                type: 'POST',
                url: '/deleteonly',
                cache: false,
                data: {
                    id: id
                },
                error: function() {
                    alert('加载页面时出错！')
                },
                success: function(content) {
                    $this.parents('tr').remove();
                    alert('删除成功！');
                }
            });

        })
    }
    </script>
</body>

</html>